<!DOCTYPE html>
<!---My first Census Data Download website-->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>"Census Data Download API</title>
    <!---<script src="CensusAPI.js"></script>-->
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
</head>
<body>
    <h2>Census API Download</h2>
    <div>
        <section id="form">
            <p>This site provides a light-weight, user-friendly interface integrated with the Census API to download data in smaller snippets the the U.S. Census Bureau.</p>
            <form>
                <h3>Enter your information:</h3>   
                <p>Variable:</p>
                <input type="text" id="variable" name="variable">
                <br>
                <p>Geography:</p>
                <input type="text" id="geography" name="geography">
                <br>
                <br>
                <button type="button" onclick="getInputValue();">Submit</button>
                <button onclick="download_csv()">Download CSV</button> 
            </form>
           <p id="output"></p>
        </section>
    </div>
    <script>
        //creates function to get input from form. and return Census API information 
        function getInputValue() {
             //new instance of xmlhttprequest class 
            let request = new XMLHttpRequest();

            //gets inputs from the form
            var variable = document.getElementById("variable").value
            var geography = document.getElementById("geography").value
        
            //prefix url for which we will append the inputs from the prompts
            const url = "https://api.census.gov/data/2018/acs/acs5/subject?get=";

            //API Key
            const apiKey = "6df8ecbbdd76fb9432d628ae6178349765cba241";

            //constructs url endpoint we will make our request from
            const link = `${url}${variable}${",NAME&for="}${geography}${" :*&key="}${apiKey}`;

            //begin to access the JSON data
            request.onreadystatechange = () => {
                let data = JSON.parse(request.response);
                //gets the html element we want to put our data in
                let x = document.getElementById("output");
                if (request.readyState === XMLHttpRequest.DONE) {
                    console.log(data);
                    //sets the content of our p element equal to our data
                    x.innerHTML = data
                } 
                function download_csv() {
                        var csv = 'Name,Title\n';
                        data.forEach(function(row) {
                                csv += row.join(',');
                                csv += "\n";
                        });
                    
                        console.log(csv);
                        var hiddenElement = document.createElement('a');
                        hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                        hiddenElement.target = '_blank';
                        hiddenElement.download = 'people.csv';
                        hiddenElement.click();
                    } 
            }

            //opens a new connection, using the GET request on the URL endpoint
            request.open("GET", link);

            //Send request
            request.send();
        }
    </script>
</body>
</html>